<?php
    include('./top.php');
    ?>
        <!-- Start Header Bottom -->
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8 col-md-6 col-12">
                    <div class="nav-inner">
                        <!-- Start Mega Category Menu -->
                        <div class="mega-category-menu">
                            <br><br><br>
                            <span class="cat-button"><i class="lni lni-menu"></i>All Categories</span>
                            <br><br><Br>
                            <ul class="sub-category">
                            <li><a href="/search-result.php?search_keyword=디지털/가전">디지털/가전 <i class="lni lni-chevron-right"></i></a>
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=삼성">삼성</a></li>
                                <li><a href="/search-result.php?search_keyword=LG">LG</a></li>
                                <li><a href="/search-result.php?search_keyword=애플">애플</a></li>
                                <li><a href="/search-result.php?search_keyword=캐논">캐논</a></li>
                                <li><a href="/search-result.php?search_keyword=닌텐도">닌텐도</a></li>
                                <li><a href="/search-result.php?search_keyword=플레이스테이션">플레이스테이션</a></li>
                                <li><a href="/search-result.php?search_keyword=소니">소니</a></li>
                                <li><a href="/search-result.php?search_keyword=다이슨">다이슨</a></li>
                                <li><a href="/search-result.php?search_keyword=Batteries">Batteries</a></li>
                                <li><a href="/search-result.php?search_keyword=Cables & Adapters">Cables & Adapters</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=음반/악기">음반/악기 <i class="lni lni-chevron-right"></i></a>
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=클래식">클래식</a></li>
                                <li><a href="/search-result.php?search_keyword=재즈">재즈</a></li>
                                <li><a href="/search-result.php?search_keyword=팝송">팝송</a></li>
                                <li><a href="/search-result.php?search_keyword=JPOP">JPOP</a></li>
                                <li><a href="/search-result.php?search_keyword=국내음악">국내음악</a></li>
                                <li><a href="/search-result.php?search_keyword=CD">CD</a></li>
                                <li><a href="/search-result.php?search_keyword=DVD">DVD</a></li>
                                <li><a href="/search-result.php?search_keyword=LP판">LP판</a></li>
                                <li><a href="/search-result.php?search_keyword=앨범">앨범</a></li>
                                <li><a href="/search-result.php?search_keyword=Cables & Adapters">Cables & Adapters</a></li>
                            </ul>
                            </li>
                            <li>
                            <a href="/search-result.php?search_keyword=뷰티/미용">뷰티/미용 <i class="lni lni-chevron-right"></i></a>
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">스포츠/레저 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">차량/오토바이 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">예술/희귀 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">가구/인테리어 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">생활/주방용품 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">도서/티켓 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">스타굿즈 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">키덜트 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">유아동/출산 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">남성의류 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">여성의류 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">가방 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">신발 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">반려동물용품 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">공구/산업용품 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            <li><a href="/search-result.php?search_keyword=">기타 <i class="lni lni-chevron-right"></i></a>                                
                            <ul class="inner-sub-category">
                                <li><a href="/search-result.php?search_keyword=Digital Cameras">Digital Cameras</a></li>
                                <li><a href="/search-result.php?search_keyword=Camcorders">Camcorders</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Lenses">Camera Lenses</a></li>
                                <li><a href="/search-result.php?search_keyword=Camera Accessories">Camera Accessories</a></li>
                                <li><a href="/search-result.php?search_keyword=Telescopes">Telescopes</a></li>
                                <li><a href="/search-result.php?search_keyword=Binoculars">Binoculars</a></li>
                                <li><a href="/search-result.php?search_keyword=Microscopes">Microscopes</a></li>
                            </ul>
                            </li>
                            </ul>
                        </div>
                        <!-- End Mega Category Menu -->
                        <!-- Start Navbar -->
                        <nav class="navbar navbar-expand-lg">
                            <button class="navbar-toggler mobile-menu-btn" type="button" data-bs-toggle="collapse"
                                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                aria-expanded="false" aria-label="Toggle navigation">
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                            </button>
                            <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent">
                                <ul id="nav" class="navbar-nav ms-auto">
                                <!-- 환숭님 여기예요 여기 수정해주세요 -->
                                </ul>
                            </div> <!-- navbar collapse -->
                        </nav>
                        <!-- End Navbar -->
                    </div>
                </div>
            </div>
        </div>
        <!-- End Header Bottom -->
    </header>
    <!-- End Header Area -->

    <!-- Start Hero Area -->
    <section class="hero-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-12 custom-padding-right">
                        <!-- Start Small Banner -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- End Hero Area -->
    

    <!-- Start current Product Area -->
    <section class="trending-product section" style="margin-top: 12px;">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="section-title">
                        <h2>최근 올라온 게시글</h2>
                        <?php
                            if(isset($_SESSION['name']))
                            {  ?>    
                                <p><b><?php  echo $_SESSION['name']; ?></b>님 주변에 사는 이웃들이 어떠한 물품을 올렸는지 확인해보세요!</p>
                            <?php } else {?>
                                <p>이용자님 주변에 사는 이웃들이 어떠한 물품을 올렸는지 확인해보세요!</p>
                            <?php } ?>
                    </div>
                </div>
            </div>
            <?php 
                include('./dbconn.php'); 
                $dbconn = dbconn(); 
                $sql = "SELECT * FROM RegProductTbl ORDER BY idx DESC LIMIT 0,8";
                $result = $dbconn->query($sql); // 쿼리 실행
                ?>

                <div class="row">
                    <?php while ($PD = $result->fetch_object()) {
                        $query2 = "SELECT * FROM CategoryTbl WHERE RegProductTbl_idx1 = $PD->idx";
                        $result2 = $dbconn->query($query2) or die("query error => " . $dbconn->error);
                        $CT = $result2->fetch_object();

                        $query3 = "SELECT * FROM Scategorytbl WHERE RegProductTbl_idx = $PD->idx";
                        $result3 = $dbconn->query($query3) or die("query error => " . $dbconn->error);
                        $SCT = $result3->fetch_object();

                        $query4 = "SELECT path FROM filepathTbl WHERE RegProductTbl_idx = $PD->idx";
                        $result4 = $dbconn->query($query4) or die("query error => " . $dbconn->error);

                        // Fetch all paths into an array
                        $paths = array();
                        while ($row = $result4->fetch_object()) {
                            $paths[] = $row->path;
                        }
                        ?>

                        <div class="col-lg-3 col-md-6 col-12">
                            <!-- Start Single Product -->
                            <div class="single-product" onclick="window.location.href='product-board.php?product_id=<?php echo $PD->idx; ?>'">
                                <div class="product-image">
                                    <?php
                                    $title = $PD->title;
                                    $path = ""; // 이미지 경로 초기화
                                    if (!empty($paths)) {
                                        $path = $paths[0]; // 첫 번째 이미지 경로 사용
                                    }
                                    ?>
                                    <img src="<?php echo $path; ?>" alt="이미지를 불러오지 못하였습니다.">
                                </div>
                                <div class="product-info">
                                    <span class="category">[<?php echo $PD->type; ?>] <?php echo $CT->name; ?><br></span>
                                    <h4 class="title">
                                        <a href="/product-board.php?product_id=<?php echo $PD->idx; ?>"><?php echo $title; ?></a>
                                    </h4>
                                    <ul class="review">
                                    <?php
                                    
                                    $rating = $PD->favorite;

                                    $getCommentCountSql = "SELECT COUNT(*) AS commentCount FROM comment WHERE RegProductTbl_idx = ?";
                                    $stmt_getCommentCount = mysqli_prepare($dbconn, $getCommentCountSql);
                                    mysqli_stmt_bind_param($stmt_getCommentCount, "i", $PD->idx);
                                    mysqli_stmt_execute($stmt_getCommentCount);
                                    $getCommentCountResult = mysqli_stmt_get_result($stmt_getCommentCount);

                                    if ($getCommentCountRow = mysqli_fetch_assoc($getCommentCountResult)) {
                                        $commentcount = $getCommentCountRow['commentCount'];
                                    } else {
                                        $commentcount = 0; // 댓글이 없는 경우 0으로 초기화
                                    }

                                    // 평점 별점 아이콘 개수 설정
                                    $filledStars = floor($rating); // 평점에 해당하는 가득 찬 별 아이콘 개수
                                    $halfStar = ($rating - $filledStars) >= 0.5; // 0.5 이상인 경우 반 별 아이콘 표시
                                    $emptyStars = 5 - $filledStars - $halfStar; // 나머지 빈 별 아이콘 개수

                                    // 가득 찬 별 아이콘 출력
                                    for ($i = 0; $i < $filledStars; $i++) {
                                        echo '<li><i class="lni lni-star-filled"></i></li>';
                                    }

                                    // 반 별 아이콘 출력
                                    if ($halfStar) {
                                        echo '<li><i class="lni lni-star-filled"></i></li>';
                                    }

                                    // 빈 별 아이콘 출력
                                    for ($i = 0; $i < $emptyStars; $i++) {
                                        echo '<li><i class="lni lni-star"></i></li>';
                                    }

                                    // 평점 리뷰 개수 출력
                                    echo '<li><span>' . $commentcount . ' Review(s)</span></li>';
                                    ?>
                                </ul>

                                    <div class="price">
                                        <span><?php echo $PD->price; ?></span>s
                                    </div>
                                </div>
                            </div>
                            <!-- End Single Product -->
                        </div>
                    <?php } ?>
                </div>
            </section>
            <!-- End Trending Product Area -->

            <!-- Start Call Action Area -->
            <section class="call-action section">
            <div class="container">
            <div class="row">
                    <div class="col-lg-8 offset-lg-2 col-12">
                        <div class="inner">
                            <div class="content">
                                <h2 class="wow fadeInUp" data-wow-delay=".4s">지금 이 순간 가장 핫한 게시글을 만나보세요</h2>
                                <p class="wow fadeInUp" data-wow-delay=".6s">조회수와 좋아요, 찜 갯수가 가장 많은 게시글 순서대로 보여집니다.</p>
                                <div class="button wow fadeInUp" data-wow-delay=".8s">
                                <a href="#banner" class="btn" data-bs-toggle="scroll" data-bs-target="#banner">보러가기</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- End Call Action Area -->

        
         <!-- Start current Product Area -->
    <section class="trending-product section" style="margin-top: 12px;">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="section-title">
                        <h2>실시간 인기 게시글</h2>
                        <?php
                            if(isset($_SESSION['name']))
                            {  ?>    
                                <p>현재 시각 (<b id="datetime"></b>) 기준 조회수가 가장 높은 게시글 순서대로 보여집니다.</p>

                                <script>
                                    function updateDateTime() {
                                        var now = new Date(); // 현재 날짜와 시간 가져오기
                                        var year = now.getFullYear(); // 년도
                                        var month = now.getMonth() + 1; // 월 (0부터 시작하므로 1을 더해줌)
                                        var day = now.getDate(); // 일
                                        var hours = now.getHours(); // 시간
                                        var minutes = now.getMinutes(); // 분
                                        var seconds = now.getSeconds(); // 초

                                        // 시간, 분, 초를 2자리로 표시하기 위해 앞에 0 추가
                                        hours = ("0" + hours).slice(-2);
                                        minutes = ("0" + minutes).slice(-2);
                                        seconds = ("0" + seconds).slice(-2);

                                        var datetimeString = year + "년" + month + "월" + day + "일 " + hours + "시" + minutes + "분" + seconds + "초";

                                        // 시간과 날짜를 표시할 요소에 출력
                                        document.getElementById("datetime").textContent = datetimeString;
                                    }

                                    // 매 초마다 updateDateTime 함수 호출
                                    setInterval(updateDateTime, 1000);
                                </script>
                            <?php } else {?>
                                <p>이용자님 주변에 사는 이웃들이 어떠한 물품을 올리셨는지 확인해보세요!</p>
                            <?php } ?>
                    </div>
                </div>
            </div>
            <?php 
                $sql3 = "SELECT * FROM RegProductTbl ORDER BY view DESC LIMIT 0,8";
                $result3 = $dbconn->query($sql3); // 쿼리 실행
                ?>

                <div class="row">
                    <?php while ($PD3 = $result3->fetch_object()) {
                        $query23 = "SELECT * FROM CategoryTbl WHERE RegProductTbl_idx1 = $PD3->idx";
                        $result23 = $dbconn->query($query23) or die("query error => " . $dbconn->error);
                        $CT3 = $result23->fetch_object();

                        $query33 = "SELECT * FROM Scategorytbl WHERE RegProductTbl_idx = $PD3->idx";
                        $result33 = $dbconn->query($query33) or die("query error => " . $dbconn->error);
                        $SCT3 = $result33->fetch_object();

                        $query43 = "SELECT path FROM filepathTbl WHERE RegProductTbl_idx = $PD3->idx";
                        $result43 = $dbconn->query($query43) or die("query error => " . $dbconn->error);

                        // Fetch all paths into an array
                        $paths3 = array();
                        while ($row3 = $result43->fetch_object()) {
                            $paths3[] = $row3->path;
                        }
                        ?>

                        <div class="col-lg-3 col-md-6 col-12">
                            <!-- Start Single Product -->
                            <div class="single-product" onclick="window.location.href='product-board.php?product_id=<?php echo $PD3->idx; ?>'">
                                <div class="product-image">
                                    <?php
                                    $title3 = $PD3->title;
                                    $path3 = ""; // 이미지 경로 초기화
                                    if (!empty($paths3)) {
                                        $path3 = $paths3[0]; // 첫 번째 이미지 경로 사용
                                    }
                                    ?>
                                    <img src="<?php echo $path3; ?>" alt="이미지를 불러오지 못하였습니다.">
                                </div>
                                <div class="product-info">
                                    <span class="category">[<?php echo $PD3->type; ?>] <?php echo $CT3->name; ?><br></span>
                                    <h4 class="title">
                                        <a href="/product-board.php?product_id=<?php echo $PD3->idx; ?>"><?php echo $title3; ?></a>
                                    </h4>
                                    <ul class="review">
                                    <?php
                                    
                                    $rating3 = $PD3->favorite;

                                    $getCommentCountSql3 = "SELECT COUNT(*) AS commentCount FROM comment WHERE RegProductTbl_idx = ?";
                                    $stmt_getCommentCount3 = mysqli_prepare($dbconn, $getCommentCountSql3);
                                    mysqli_stmt_bind_param($stmt_getCommentCount3, "i", $PD3->idx);
                                    mysqli_stmt_execute($stmt_getCommentCount3);
                                    $getCommentCountResult3 = mysqli_stmt_get_result($stmt_getCommentCount3);
                                    if ($getCommentCountRow3 = mysqli_fetch_assoc($getCommentCountResult3)) {
                                        $commentcount3 = $getCommentCountRow3['commentCount'];
                                    } else {
                                        $commentcount3 = 0; // 댓글이 없는 경우 0으로 초기화
                                    }

                                    // 평점 별점 아이콘 개수 설정
                                    $filledStars3 = floor($rating3); // 평점에 해당하는 가득 찬 별 아이콘 개수
                                    $halfStar3 = ($rating3 - $filledStars3) >= 0.5; // 0.5 이상인 경우 반 별 아이콘 표시
                                    $emptyStars3 = 5 - $filledStars3 - $halfStar3; // 나머지 빈 별 아이콘 개수

                                    // 가득 찬 별 아이콘 출력
                                    for ($i = 0; $i < $filledStars3; $i++) {
                                        echo '<li><i class="lni lni-star-filled"></i></li>';
                                    }

                                    // 반 별 아이콘 출력
                                    if ($halfStar3) {
                                        echo '<li><i class="lni lni-star-filled"></i></li>';
                                    }

                                    // 빈 별 아이콘 출력
                                    for ($i = 0; $i < $emptyStars3; $i++) {
                                        echo '<li><i class="lni lni-star"></i></li>';
                                    }

                                    // 평점 리뷰 개수 출력
                                    echo '<li><span>' . $commentcount3 . ' Review(s)</span></li>';
                                    ?>
                                </ul>

                                    <div class="price">
                                        <span><?php echo $PD3->price; ?></span>
                                    </div>
                                </div>
                            </div>
                            <!-- End Single Product -->
                        </div>
                    <?php } ?>
                </div>
            </section>
            <!-- End Trending Product Area -->

        <!-- Start Banner Area -->
        <section class="banner section" id="banner">
            <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6 col-12">
                <?php
                $hotsql = "SELECT * FROM RegProductTbl ORDER BY view DESC LIMIT 1";
                $resulthotsql = $dbconn->query($hotsql); // 쿼리 실행
                $hot = $resulthotsql->fetch_object();

                $pathsql = "SELECT path FROM filepathTbl WHERE RegProductTbl_idx = $hot->idx";
                $resultpathsql = $dbconn->query($pathsql) or die("query error => " . $dbconn->error);

                $images = array();
                while ($row = $resultpathsql->fetch_object()) {
                    $images[] = $row->path;
                }
                $title = $hot->title;
                if (strlen($title) > 30) {
                    $title = mb_substr($hot->title, 0, 30, "utf-8") . "...";
                }
                $image = "";
                if (!empty($images)) {
                    $image = $images[0];
                }

                $imagePath = "assets/images/banner/banner-1-bg.jpg"; // 기본 이미지 경로
                if (!empty($image)) {
                    $imagePath = $image;
                }
                ?>
                <div class="single-banner" style="background-image: url('<?php echo $imagePath; ?>')">
                <div class="lay"></div>
                    <div class="content" style="position: relative; z-index: 2;">
                        <h2><b><?php echo $hot->title; ?></b></h2>
                        <p>사람들이 가장 많이 조회하고 있어요!</p>
                        <div class="button">
                            <a href="/product-board.php?product_id=<?php echo $hot->idx; ?>" class="btn">자세히 보기</a>
                        </div>
                    </div>
                </div>

                <style>
                    .single-banner {
                        position: relative;
                    }

                    .single-banner .lay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 50%;
                        height: 100%;
                        background-color: #FFd;
                        opacity: 0.8;
                        z-index: 1;
                    }
                </style>
                </div>

                <div class="col-lg-6 col-md-6 col-12">
                <?php
                    $bestsql = "SELECT * FROM RegProductTbl ORDER BY favorite DESC LIMIT 1";
                    $resultbestsql = $dbconn->query($bestsql); // 쿼리 실행
                    $best = $resultbestsql->fetch_object();
    
                    $pathsql1 = "SELECT path FROM filepathTbl WHERE RegProductTbl_idx = $best->idx";
                    $resultpathsql1 = $dbconn->query($pathsql1) or die("query error => " . $dbconn->error);

                    $images1 = array();
                    while ($row1 = $resultpathsql1->fetch_object()) {
                        $images1[] = $row1->path;
                    }
                    $image1 = "";
                    if (!empty($images1)) {
                        $image1 = $images1[0];
                    }

                    $imagePath1 = "assets/images/banner/banner-1-bg.jpg"; // 기본 이미지 경로
                    if (!empty($image1)) {
                        $imagePath1 = $image1;
                    }
                    ?>
                    
                    <div class="single-banner custom-responsive-margin" style="background-image: url('<?php echo $imagePath1; ?>')">
                    <div class="lay"></div>
                    <div class="content" style="position: relative; z-index: 2;">
                            <h2><?php echo $best->title; ?></h2>
                            <p> 리뷰 평점이 가장 높은 게시글이에요! </p>
                            <div class="button">
                                <a href="/product-board.php?product_id=<?php echo $best->idx; ?>" class="btn">자세히 보기</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </section>
        <!-- End Banner Area -->

         <!-- Start current Product Area -->
    <section class="trending-product section" id="recom" style="margin-top: 12px;">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="section-title">
                        <h2>리뷰가 좋은 게시글</h2>
                        <p>리뷰 평점이 좋은 게시글 순서대로 보여집니다.</p>
                    </div>
                </div>
            </div>
            <?php 
                $sql4 = "SELECT * FROM RegProductTbl ORDER BY favorite DESC LIMIT 0,8";
                $result4 = $dbconn->query($sql4); // 쿼리 실행
                ?>

                <div class="row">
                    <?php while ($PD4 = $result4->fetch_object()) {
                        $query24 = "SELECT * FROM CategoryTbl WHERE RegProductTbl_idx1 = $PD4->idx";
                        $result24 = $dbconn->query($query24) or die("query error => " . $dbconn->error);
                        $CT4 = $result24->fetch_object();

                        $query44 = "SELECT * FROM Scategorytbl WHERE RegProductTbl_idx = $PD4->idx";
                        $result44 = $dbconn->query($query44) or die("query error => " . $dbconn->error);
                        $SCT4 = $result44->fetch_object();

                        $query44 = "SELECT path FROM filepathTbl WHERE RegProductTbl_idx = $PD4->idx";
                        $result44 = $dbconn->query($query44) or die("query error => " . $dbconn->error);

                        // Fetch all paths into an array
                        $paths4 = array();
                        while ($row4 = $result44->fetch_object()) {
                            $paths4[] = $row4->path;
                        }
                        ?>

                        <div class="col-lg-3 col-md-6 col-12">
                            <!-- Start Single Product -->
                            <div class="single-product" onclick="window.location.href='product-board.php?product_id=<?php echo $PD4->idx; ?>'">
                                <div class="product-image">
                                    <?php
                                    $title4 = $PD4->title;
                                    $path4 = ""; // 이미지 경로 초기화
                                    if (!empty($paths4)) {
                                        $path4 = $paths4[0]; // 첫 번째 이미지 경로 사용
                                    }
                                    ?>
                                    <img src="<?php echo $path4; ?>" alt="이미지를 불러오지 못하였습니다.">
                                </div>
                                <div class="product-info">
                                    <span class="category">[<?php echo $PD4->type; ?>] <?php echo $CT4->name; ?><br></span>
                                    <h4 class="title">
                                        <a href="/product-board.php?product_id=<?php echo $PD4->idx; ?>"><?php echo $title4; ?></a>
                                    </h4>
                                    <ul class="review">
                                    <?php
                                    
                                    $rating4 = $PD4->favorite;

                                    $getCommentCountSql4 = "SELECT COUNT(*) AS commentCount FROM comment WHERE RegProductTbl_idx = ?";
                                    $stmt_getCommentCount4 = mysqli_prepare($dbconn, $getCommentCountSql4);
                                    mysqli_stmt_bind_param($stmt_getCommentCount4, "i", $PD4->idx);
                                    mysqli_stmt_execute($stmt_getCommentCount4);
                                    $getCommentCountResult4 = mysqli_stmt_get_result($stmt_getCommentCount4);

                                    if ($getCommentCountRow4 = mysqli_fetch_assoc($getCommentCountResult4)) {
                                        $commentcount4 = $getCommentCountRow4['commentCount'];
                                    } else {
                                        $commentcount4 = 0; // 댓글이 없는 경우 0으로 초기화
                                    }

                                    // 평점 별점 아이콘 개수 설정
                                    $filledStars4 = floor($rating4); // 평점에 해당하는 가득 찬 별 아이콘 개수
                                    $halfStar4 = ($rating4 - $filledStars4) >= 0.5; // 0.5 이상인 경우 반 별 아이콘 표시
                                    $emptyStars4 = 5 - $filledStars4 - $halfStar4; // 나머지 빈 별 아이콘 개수

                                    // 가득 찬 별 아이콘 출력
                                    for ($i = 0; $i < $filledStars4; $i++) {
                                        echo '<li><i class="lni lni-star-filled"></i></li>';
                                    }

                                    // 반 별 아이콘 출력
                                    if ($halfStar4) {
                                        echo '<li><i class="lni lni-star-filled"></i></li>';
                                    }

                                    // 빈 별 아이콘 출력
                                    for ($i = 0; $i < $emptyStars4; $i++) {
                                        echo '<li><i class="lni lni-star"></i></li>';
                                    }

                                    // 평점 리뷰 개수 출력
                                    echo '<li><span>' . $commentcount4 . ' Review(s)</span></li>';
                                    ?>
                                </ul>

                                    <div class="price">
                                        <span><?php echo $PD4->price; ?></span>
                                    </div>
                                </div>
                            </div>
                            <!-- End Single Product -->
                        </div>
                    <?php } ?>
                </div>
            </section>
            <!-- End Trending Product Area -->
            <!-- Start Call Action Area -->
            <section class="call-action section">
            <div class="container">
            <div class="row">
                    <div class="col-lg-8 offset-lg-2 col-12">
                        <div class="inner">
                            <div class="content">
                                <h2 class="wow fadeInUp" data-wow-delay=".4s">평가가 좋은 게시글을 찾고 계신가요?</h2>
                                <p class="wow fadeInUp" data-wow-delay=".6s">생생한 거래 후기와 함께 신뢰도가 높은 게시글을 만나보세요</p>
                                <div class="button wow fadeInUp" data-wow-delay=".8s">
                                <a href="#recom" class="btn" data-bs-toggle="scroll" data-bs-target="#recom">보러가기</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- End Call Action Area -->
    <!-- Start Shipping Info -->
    <section class="shipping-info">
        <div class="container">
            <ul>
                <!-- Free Shipping -->
                <li>
                    <div class="media-icon">
                        <i class="lni lni-delivery"></i>
                    </div>
                    <div class="media-body">
                        <h5>무료 배송</h5>
                        <span>5회 이용시 추가로 발생되는 배달비를 환급해드립니다.</span>
                    </div>
                </li>
                <!-- Money Return -->
                <li>
                    <div class="media-icon">
                        <i class="lni lni-support"></i>
                    </div>
                    <div class="media-body">
                        <h5>24/7 고객지원</h5>
                        <span>실시간 채팅 혹은 전화 문dml로 이루어집니다.</span>
                    </div>
                </li>
                <!-- Support 24/7 -->
                <li>
                    <div class="media-icon">
                        <i class="lni lni-credit-cards"></i>
                    </div>
                    <div class="media-body">
                        <h5>간편한 결제 방식</h5>
                        <span>애플마켓만의 결제 방식으로 민감정보 노출을 방지하세요. </span>
                    </div>
                </li>
                <!-- Safe Payment -->
                <li>
                    <div class="media-icon">
                        <i class="lni lni-reload"></i>
                    </div>
                    <div class="media-body">
                        <h5>Easy Return.</h5>
                        <span>Hassle Free Shopping.</span>
                    </div>
                </li>
            </ul>
        </div>
    </section>
    <!-- End Shipping Info -->

    <?php
    include('./btm.php');
    ?>

</body>
</html>